# mnemine Production Deployment Guide

## 🚀 Render Deployment Configuration

### Prerequisites
- Render account
- GitHub repository connected
- Admin password: `nemesisN3M3616`

### Environment Variables

#### Backend Service (mnemine-backend)
```bash
NODE_ENV=production
PORT=10000
DATABASE_URL=<from-database-connection>
JWT_SECRET=<auto-generated>
ENCRYPTION_KEY=<auto-generated>
SESSION_SECRET=<auto-generated>
ADMIN_PASSWORD=nemesisN3M3616
ADMIN_TELEGRAM_ID=6760298907
ADMIN_TELEGRAM_IDS=6760298907
TELEGRAM_BOT_TOKEN=<your-bot-token>
TELEGRAM_WEBHOOK_SECRET=<auto-generated>
RATE_LIMIT_MAX_REQUESTS=50
RATE_LIMIT_WINDOW_MS=900000
LOG_LEVEL=warn
LOCAL_DEV_MODE=false
ENABLE_FALLBACK_AUTH=false
```

#### Frontend Service (mnemine-frontend)
```bash
VITE_BACKEND_URL=https://mnemine-backend.onrender.com
VITE_WS_URL=wss://mnemine-backend.onrender.com/ws
VITE_APP_NAME=NONMINE
VITE_APP_VERSION=1.0.0
VITE_ADMIN_TELEGRAM_IDS=6760298907
LOCAL_DEV_MODE=false
ENABLE_FALLBACK_AUTH=false
```

### Deployment Steps

#### 1. Database Setup
1. Create a PostgreSQL database on Render
2. Note the connection string
3. Set `DATABASE_URL` environment variable

#### 2. Backend Deployment
1. Create a new Web Service on Render
2. Connect your GitHub repository
3. Set the following:
   - **Build Command**: `cd server && npm install && npm run build:prod && npm run prisma:generate:prod`
   - **Start Command**: `cd server && npm run start:prod`
   - **Environment**: Node
   - **Plan**: Starter (or higher)

#### 3. Frontend Deployment
1. Create a new Static Site on Render
2. Connect your GitHub repository
3. Set the following:
   - **Build Command**: `cd client && npm install && npm run build`
   - **Publish Directory**: `client/dist`
   - **Environment**: Static

#### 4. Environment Variables Setup
Set all the environment variables listed above in the Render dashboard.

### Production Build Commands

```bash
# Full production build
pnpm run build:prod

# Individual builds
pnpm run build:client
pnpm run build:server:prod

# Copy frontend to server
pnpm run copy:frontend

# Start production server
pnpm run start:prod
```

### Security Configuration

#### Admin Access
- **Admin Password**: `nemesisN3M3616`
- **Admin Telegram ID**: `6760298907`
- **Access Level**: Full administrative privileges

#### Rate Limiting
- **Max Requests**: 50 per window
- **Window**: 15 minutes (900000ms)
- **Applied to**: All API endpoints

#### CORS Configuration
- **Allowed Origins**: Your frontend domain
- **Credentials**: Enabled
- **Methods**: GET, POST, PUT, DELETE, OPTIONS

### Database Migration

```bash
# Generate Prisma client
pnpm run prisma:generate:prod

# Push schema to production database
pnpm run prisma:push:prod

# Run migrations (if needed)
pnpm run prisma:migrate:prod
```

### Monitoring and Logs

#### Log Levels
- **Production**: `warn` (reduces noise)
- **Development**: `debug` (full logging)

#### Health Checks
- **Backend**: `GET /api/health`
- **Database**: Automatic connection monitoring
- **WebSocket**: Connection status monitoring

### Performance Optimization

#### Frontend Optimizations
- **Code Splitting**: Enabled
- **Tree Shaking**: Enabled
- **Minification**: Terser
- **Chunk Optimization**: Manual chunks for vendor libraries

#### Backend Optimizations
- **Compression**: Gzip enabled
- **Caching**: Static assets cached
- **Rate Limiting**: Configured
- **Security Headers**: Helmet.js enabled

### Troubleshooting

#### Common Issues

1. **Database Connection Failed**
   - Check `DATABASE_URL` format
   - Verify database is running
   - Check network connectivity

2. **Build Failures**
   - Ensure all dependencies are installed
   - Check Node.js version (>=20.0.0)
   - Verify environment variables

3. **Frontend Not Loading**
   - Check `VITE_BACKEND_URL` configuration
   - Verify CORS settings
   - Check browser console for errors

#### Debug Commands

```bash
# Check deployment status
pnpm run verify:production

# Test database connection
pnpm run prisma:studio

# Check build output
ls -la server/dist/
ls -la client/dist/
```

### Post-Deployment Checklist

- [ ] Database connection established
- [ ] Backend API responding
- [ ] Frontend loading correctly
- [ ] Admin access working
- [ ] Telegram bot integration
- [ ] WebSocket connections
- [ ] Rate limiting active
- [ ] Security headers present
- [ ] SSL certificates valid
- [ ] Performance metrics normal

### URLs

- **Frontend**: `https://mnemine-frontend.onrender.com`
- **Backend**: `https://mnemine-backend.onrender.com`
- **Admin Panel**: `https://mnemine-frontend.onrender.com/admin`

### Support

For deployment issues:
1. Check Render logs
2. Verify environment variables
3. Test database connectivity
4. Review build output
5. Check network configuration

### Security Notes

- Admin password is set to: `nemesisN3M3616`
- All secrets are auto-generated for security
- Rate limiting is configured
- CORS is properly configured
- Security headers are enabled
- Database connections are encrypted

